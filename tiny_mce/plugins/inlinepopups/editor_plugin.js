(function(){var e=tinymce.DOM,w=tinymce.dom.Element,h=tinymce.dom.Event,s=tinymce.each,B=tinymce.is;tinymce.create("tinymce.plugins.InlinePopups",{init:function(a,c){a.onBeforeRenderUI.add(function(){a.windowManager=new tinymce.InlineWindowManager(a);e.loadCSS(c+"/skins/"+(a.settings.inlinepopups_skin||"clearlooks2")+"/window.css")})},getInfo:function(){return{longname:"InlinePopups",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/inlinepopups",
version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.create("tinymce.InlineWindowManager:tinymce.WindowManager",{InlineWindowManager:function(a){this.parent(a);this.zIndex=3E5;this.count=0;this.windows={}},open:function(a,c){var b=this,d,f="",q=b.editor,r=0,n=0,g,p,a=a||{},c=c||{};if(!a.inline)return b.parent(a,c);if((g=b._frontWindow())&&e.get(g.id+"_ifr"))g.focussedElement=e.get(g.id+"_ifr").contentWindow.document.activeElement;a.type||(b.bookmark=q.selection.getBookmark(1));d=e.uniqueId();
g=e.getViewPort();a.width=parseInt(a.width||320);a.height=parseInt(a.height||240)+(tinymce.isIE?8:0);a.min_width=parseInt(a.min_width||150);a.min_height=parseInt(a.min_height||100);a.max_width=parseInt(a.max_width||2E3);a.max_height=parseInt(a.max_height||2E3);a.left=a.left||Math.round(Math.max(g.x,g.x+g.w/2-a.width/2));a.top=a.top||Math.round(Math.max(g.y,g.y+g.h/2-a.height/2));a.movable=a.resizable=!0;c.mce_width=a.width;c.mce_height=a.height;c.mce_inline=!0;c.mce_window_id=d;c.mce_auto_focus=a.auto_focus;
b.features=a;b.params=c;b.onOpen.dispatch(b,a,c);a.type&&(f+=" mceModal",a.type&&(f+=" mce"+a.type.substring(0,1).toUpperCase()+a.type.substring(1)),a.resizable=!1);a.statusbar&&(f+=" mceStatusbar");a.resizable&&(f+=" mceResizable");a.minimizable&&(f+=" mceMinimizable");a.maximizable&&(f+=" mceMaximizable");a.movable&&(f+=" mceMovable");b._addAll(e.doc.body,["div",{id:d,role:"dialog","aria-labelledby":a.type?d+"_content":d+"_title","class":(q.settings.inlinepopups_skin||"clearlooks2")+(tinymce.isIE&&
window.getSelection?" ie9":""),style:"width:100px;height:100px"},["div",{id:d+"_wrapper","class":"mceWrapper"+f},["div",{id:d+"_top","class":"mceTop"},["div",{"class":"mceLeft"}],["div",{"class":"mceCenter"}],["div",{"class":"mceRight"}],["span",{id:d+"_title"},a.title||""]],["div",{id:d+"_middle","class":"mceMiddle"},["div",{id:d+"_left","class":"mceLeft",tabindex:"0"}],["span",{id:d+"_content"}],["div",{id:d+"_right","class":"mceRight",tabindex:"0"}]],["div",{id:d+"_bottom","class":"mceBottom"},
["div",{"class":"mceLeft"}],["div",{"class":"mceCenter"}],["div",{"class":"mceRight"}],["span",{id:d+"_status"}]],["a",{"class":"mceMove",tabindex:"-1",href:"javascript:;"}],["a",{"class":"mceMin",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceMax",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceMed",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceClose",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],
["a",{id:d+"_resize_n","class":"mceResize mceResizeN",tabindex:"-1",href:"javascript:;"}],["a",{id:d+"_resize_s","class":"mceResize mceResizeS",tabindex:"-1",href:"javascript:;"}],["a",{id:d+"_resize_w","class":"mceResize mceResizeW",tabindex:"-1",href:"javascript:;"}],["a",{id:d+"_resize_e","class":"mceResize mceResizeE",tabindex:"-1",href:"javascript:;"}],["a",{id:d+"_resize_nw","class":"mceResize mceResizeNW",tabindex:"-1",href:"javascript:;"}],["a",{id:d+"_resize_ne","class":"mceResize mceResizeNE",
tabindex:"-1",href:"javascript:;"}],["a",{id:d+"_resize_sw","class":"mceResize mceResizeSW",tabindex:"-1",href:"javascript:;"}],["a",{id:d+"_resize_se","class":"mceResize mceResizeSE",tabindex:"-1",href:"javascript:;"}]]]);e.setStyles(d,{top:-1E4,left:-1E4});tinymce.isGecko&&e.setStyle(d,"overflow","auto");a.type||(r+=e.get(d+"_left").clientWidth,r+=e.get(d+"_right").clientWidth,n+=e.get(d+"_top").clientHeight,n+=e.get(d+"_bottom").clientHeight);e.setStyles(d,{top:a.top,left:a.left,width:a.width+
r,height:a.height+n});if(f=a.url||a.file)tinymce.relaxedDomain&&(f+=(-1==f.indexOf("?")?"?":"&")+"mce_rdomain="+tinymce.relaxedDomain),f=tinymce._addVer(f);a.type?(e.add(d+"_wrapper","a",{id:d+"_ok","class":"mceButton mceOk",href:"javascript:;",onmousedown:"return false;"},"\u597d"),"confirm"==a.type&&e.add(d+"_wrapper","a",{"class":"mceButton mceCancel",href:"javascript:;",onmousedown:"return false;"},"\u53d6\u6d88"),e.add(d+"_middle","div",{"class":"mceIcon"}),e.setHTML(d+"_content",a.content.replace("\n",
"<br />")),h.add(d,"keyup",function(d){if(d.keyCode===27){a.button_func(false);return h.cancel(d)}}),h.add(d,"keydown",function(a){var b;if(a.keyCode===9){(b=e.select("a.mceCancel",d+"_wrapper")[0])&&b!==a.target?b.focus():e.get(d+"_ok").focus();return h.cancel(a)}})):(e.add(d+"_content","iframe",{id:d+"_ifr",src:'javascript:""',frameBorder:0,style:"border:0;width:10px;height:10px"}),e.setStyles(d+"_ifr",{width:a.width,height:a.height}),e.setAttrib(d+"_ifr","src",f));f=h.add(d,"mousedown",function(a){var c=
a.target,f;f=b.windows[d];b.focus(d);if(c.nodeName=="A"||c.nodeName=="a"){if(c.className=="mceClose"){b.close(null,d);return h.cancel(a)}if(c.className=="mceMax"){f.oldPos=f.element.getXY();f.oldSize=f.element.getSize();a=e.getViewPort();a.w=a.w-2;a.h=a.h-2;f.element.moveTo(a.x,a.y);f.element.resizeTo(a.w,a.h);e.setStyles(d+"_ifr",{width:a.w-f.deltaWidth,height:a.h-f.deltaHeight});e.addClass(d+"_wrapper","mceMaximized")}else if(c.className=="mceMed"){f.element.moveTo(f.oldPos.x,f.oldPos.y);f.element.resizeTo(f.oldSize.w,
f.oldSize.h);f.iframeElement.resizeTo(f.oldSize.w-f.deltaWidth,f.oldSize.h-f.deltaHeight);e.removeClass(d+"_wrapper","mceMaximized")}else{if(c.className=="mceMove")return b._startDrag(d,a,c.className);if(e.hasClass(c,"mceResize"))return b._startDrag(d,a,c.className.substring(13))}}});p=h.add(d,"click",function(c){var e=c.target;b.focus(d);if(e.nodeName=="A"||e.nodeName=="a")switch(e.className){case "mceClose":b.close(null,d);return h.cancel(c);case "mceButton mceOk":case "mceButton mceCancel":a.button_func(e.className==
"mceButton mceOk");return h.cancel(c)}});h.add([d+"_left",d+"_right"],"focus",function(a){var b=e.get(d+"_ifr");if(b){b=e.select(":input:enabled,*[tabindex=0]",b.contentWindow.document.body);a.target.id===d+"_left"?b[b.length-1].focus():b[0].focus()}else e.get(d+"_ok").focus()});q=b.windows[d]={id:d,mousedown_func:f,click_func:p,element:new w(d,{blocker:1,container:q.getContainer()}),iframeElement:new w(d+"_ifr"),features:a,deltaWidth:r,deltaHeight:n};q.iframeElement.on("focus",function(){b.focus(d)});
0==b.count&&"modal"==b.editor.getParam("dialog_type","modal")?(e.add(e.doc.body,"div",{id:"mceModalBlocker","class":(b.editor.settings.inlinepopups_skin||"clearlooks2")+"_modalBlocker",style:{zIndex:b.zIndex-1}}),e.show("mceModalBlocker"),e.setAttrib(e.doc.body,"aria-hidden","true")):e.setStyle("mceModalBlocker","z-index",b.zIndex-1);(tinymce.isIE6||/Firefox\/2\./.test(navigator.userAgent)||tinymce.isIE&&!e.boxModel)&&e.setStyles("mceModalBlocker",{position:"absolute",left:g.x,top:g.y,width:g.w-2,
height:g.h-2});e.setAttrib(d,"aria-hidden","false");b.focus(d);b._fixIELayout(d,1);e.get(d+"_ok")&&e.get(d+"_ok").focus();b.count++;return q},focus:function(a){var c;if(c=this.windows[a])c.zIndex=this.zIndex++,c.element.setStyle("zIndex",c.zIndex),c.element.update(),a+="_wrapper",e.removeClass(this.lastId,"mceFocus"),e.addClass(a,"mceFocus"),this.lastId=a,c.focussedElement?c.focussedElement.focus():e.get(a+"_ok")?e.get(c.id+"_ok").focus():e.get(c.id+"_ifr")&&e.get(c.id+"_ifr").focus()},_addAll:function(a,
c){var b;b=tinymce.DOM;if(B(c,"string"))a.appendChild(b.doc.createTextNode(c));else if(c.length){a=a.appendChild(b.create(c[0],c[1]));for(b=2;b<c.length;b++)this._addAll(a,c[b])}},_startDrag:function(a,c,b){function d(){g||(f._fixIELayout(a,0),e.add(n.body,"div",{id:"mceEventBlocker","class":"mceEventBlocker "+(f.editor.settings.inlinepopups_skin||"clearlooks2"),style:{zIndex:f.zIndex+1}}),(tinymce.isIE6||tinymce.isIE&&!e.boxModel)&&e.setStyles("mceEventBlocker",{position:"absolute",left:i.x,top:i.y,
width:i.w-2,height:i.h-2}),g=new w("mceEventBlocker"),g.update(),s=t.getXY(),m=t.getSize(),u=x.x+s.x-i.x,v=x.y+s.y-i.y,e.add(g.get(),"div",{id:"mcePlaceHolder","class":"mcePlaceHolder",style:{left:u,top:v,width:m.w,height:m.h}}),y=new w("mcePlaceHolder"))}var f=this,q,r,n=e.doc,g,p=f.windows[a],t=p.element;t.getXY();var s,m,y,x,i,u,v,z,A,j,k,l,o;x={x:0,y:0};i=e.getViewPort();i.w-=2;i.h-=2;z=c.screenX;A=c.screenY;j=k=l=o=0;q=h.add(n,"mouseup",function(b){h.remove(n,"mouseup",q);h.remove(n,"mousemove",
r);g&&g.remove();t.moveBy(j,k);t.resizeBy(l,o);m=t.getSize();e.setStyles(a+"_ifr",{width:m.w-p.deltaWidth,height:m.h-p.deltaHeight});f._fixIELayout(a,1);return h.cancel(b)});"Move"!=b&&d();r=h.add(n,"mousemove",function(a){var c,e;d();c=a.screenX-z;e=a.screenY-A;switch(b){case "ResizeW":j=c;l=0-c;break;case "ResizeE":l=c;break;case "ResizeN":case "ResizeNW":case "ResizeNE":"ResizeNW"==b?(j=c,l=0-c):"ResizeNE"==b&&(l=c);k=e;o=0-e;break;case "ResizeS":case "ResizeSW":case "ResizeSE":"ResizeSW"==b?(j=
c,l=0-c):"ResizeSE"==b&&(l=c);o=e;break;case "mceMove":j=c,k=e}if(l<(c=p.features.min_width-m.w))0!==j&&(j+=l-c),l=c;if(o<(c=p.features.min_height-m.h))0!==k&&(k+=o-c),o=c;l=Math.min(l,p.features.max_width-m.w);o=Math.min(o,p.features.max_height-m.h);j=Math.max(j,i.x-(u+i.x));k=Math.max(k,i.y-(v+i.y));j=Math.min(j,i.w+i.x-(u+m.w+i.x));k=Math.min(k,i.h+i.y-(v+m.h+i.y));0!==j+k&&(0>u+j&&(j=0),0>v+k&&(k=0),y.moveTo(u+j,v+k));0!==l+o&&y.resizeTo(m.w+l,m.h+o);return h.cancel(a)});return h.cancel(c)},resizeBy:function(a,
c,b){if(b=this.windows[b])b.element.resizeBy(a,c),b.iframeElement.resizeBy(a,c)},close:function(a,c){var b,d=e.doc,c=this._findId(c||a);if(this.windows[c]){if(this.count--,0==this.count&&(e.remove("mceModalBlocker"),e.setAttrib(e.doc.body,"aria-hidden","false"),this.editor.focus()),b=this.windows[c])this.onClose.dispatch(this),h.remove(d,"mousedown",b.mousedownFunc),h.remove(d,"click",b.clickFunc),h.clear(c),h.clear(c+"_ifr"),e.setAttrib(c+"_ifr","src",'javascript:""'),b.element.remove(),delete this.windows[c],
(b=this._frontWindow())&&this.focus(b.id)}else this.parent(a)},_frontWindow:function(){var a,c=0;s(this.windows,function(b){b.zIndex>c&&(a=b,c=b.zIndex)});return a},setTitle:function(a,c){var b,a=this._findId(a);if(b=e.get(a+"_title"))b.innerHTML=e.encode(c)},alert:function(a,c){var b=this,d;d=b.open({title:b,type:"alert",button_func:function(a){c&&c.call(a||b,a);b.close(null,d.id)},content:e.encode(b.editor.getLang(a,a)),inline:1,width:400,height:130})},confirm:function(a,c){var b=this,d;d=b.open({title:b,
type:"confirm",button_func:function(a){c&&c.call(a||b,a);b.close(null,d.id)},content:e.encode(b.editor.getLang(a,a)),inline:1,width:400,height:130})},_findId:function(a){if("string"==typeof a)return a;s(this.windows,function(c){var b=e.get(c.id+"_ifr");if(b&&a==b.contentWindow)return a=c.id,!1});return a},_fixIELayout:function(a,c){var b,d;if(tinymce.isIE6&&(s("n s w e nw ne sw se".split(" "),function(b){b=e.get(a+"_resize_"+b);e.setStyles(b,{width:c?b.clientWidth:"",height:c?b.clientHeight:"",cursor:e.getStyle(b,
"cursor",1)});e.setStyle(a+"_bottom","bottom","-1px")}),b=this.windows[a]))b.element.hide(),b.element.show(),s(e.select("div,a",a),function(a){"none"!=a.currentStyle.backgroundImage&&(d=new Image,d.src=a.currentStyle.backgroundImage.replace(/url\(\"(.+)\"\)/,"$1"))}),e.get(a).style.filter=""}});tinymce.PluginManager.add("inlinepopups",tinymce.plugins.InlinePopups)})();