(function(){function s(a){return"string"==typeof a?a.replace(/[^0-9%]/g,""):a}function F(a){var i,e;if(a&&!a.splice){i=[];for(e=0;;e++)if(a[e])i[e]=a[e];else break;return i}return a}var w=tinymce.explode("id,name,width,height,style,align,class,hspace,vspace,bgcolor,type"),G=tinymce.makeMap(w.join(",")),q=tinymce.html.Node,u,x,y=tinymce.util.JSON;u=[["Flash","d27cdb6e-ae6d-11cf-96b8-444553540000","application/x-shockwave-flash","http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"],
["ShockWave","166b1bca-3f9c-11cf-8075-444553540000","application/x-director","http://download.macromedia.com/pub/shockwave/cabs/director/sw.cab#version=8,5,1,0"],["WindowsMedia","6bf52a52-394a-11d3-b153-00c04f79faa6,22d6f312-b0f6-11d0-94ab-0080c74c7e95,05589fa1-c356-11ce-bf01-00aa0055595a","application/x-mplayer2","http://activex.microsoft.com/activex/controls/mplayer/en/nsmp2inf.cab#Version=5,1,52,701"],["QuickTime","02bf25d5-8c17-4b23-bc80-d3488abddc6b","video/quicktime","http://www.apple.com/qtactivex/qtplugin.cab#version=6,0,2,0"],
["RealMedia","cfcdaa03-8be4-11cf-b84b-0020afbbccfa","audio/x-pn-realaudio-plugin","http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"],["Java","8ad9c840-044e-11d1-b3e9-00805f499d93","application/x-java-applet","http://java.sun.com/products/plugin/autodl/jinstall-1_5_0-windows-i586.cab#Version=1,5,0,0"],["Silverlight","dfeaf541-f3e1-4c24-acac-99c30715084a","application/x-silverlight-2"],["Iframe"],["Video"],["EmbeddedAudio"],["Audio"]];tinymce.create("tinymce.plugins.MediaPlugin",
{init:function(a,i){function e(h){return h&&"IMG"===h.nodeName&&a.dom.hasClass(h,"mceItemMedia")}var c=this,g={},k,j,l,d;c.editor=a;c.url=i;x="";for(k=0;k<u.length;k++){d=u[k][0];l={name:d,clsids:tinymce.explode(u[k][1]||""),mimes:tinymce.explode(u[k][2]||""),codebase:u[k][3]};for(j=0;j<l.clsids.length;j++)g["clsid:"+l.clsids[j]]=l;for(j=0;j<l.mimes.length;j++)g[l.mimes[j]]=l;g["mceItem"+d]=l;g[d.toLowerCase()]=l;x+=(x?"|":"")+d}tinymce.each(a.getParam("media_types","video=mp4,m4v,ogv,webm;silverlight=xap;flash=swf,flv;shockwave=dcr;quicktime=mov,qt,mpg,mpeg;shockwave=dcr;windowsmedia=avi,wmv,wm,asf,asx,wmx,wvx;realmedia=rm,ra,ram;java=jar;audio=mp3,ogg").split(";"),
function(a){var b,c,d,a=a.split(/=/);c=tinymce.explode(a[1].toLowerCase());for(b=0;b<c.length;b++)(d=g[a[0].toLowerCase()])&&(g[c[b]]=d)});x=RegExp("write("+x+")\\(([^)]+)\\)");c.lookup=g;a.onPreInit.add(function(){a.schema.addValidElements("object[id|style|width|height|classid|codebase|*],param[name|value],embed[id|style|width|height|type|src|*],video[*],audio[*],source[*]");a.parser.addNodeFilter("object,embed,video,audio,script,iframe",function(a){for(var b=a.length;b--;)c.objectToImg(a[b])});
a.serializer.addNodeFilter("img",function(a,b,d){for(var b=a.length,e;b--;)e=a[b],-1!==(e.attr("class")||"").indexOf("mceItemMedia")&&c.imgToObject(e,d)})});a.onInit.add(function(){a.theme&&a.theme.onResolveName&&a.theme.onResolveName.add(function(c,b){"img"===b.name&&a.dom.hasClass(b.node,"mceItemMedia")&&(b.name="media")});a&&a.plugins.contextmenu&&a.plugins.contextmenu.onContextMenu.add(function(a,b,c){"IMG"===c.nodeName&&-1!==c.className.indexOf("mceItemMedia")&&b.add({title:"media.edit",icon:"media",
cmd:"mceMedia"})})});a.addCommand("mceMedia",function(){var d,b;b=a.selection.getNode();if(e(b)&&(d=a.dom.getAttrib(b,"data-mce-json")))d=y.parse(d),tinymce.each(w,function(c){var e=a.dom.getAttrib(b,c);e&&(d[c]=e)}),d.type=c.getType(b.className).name.toLowerCase();d||(d={type:"flash",video:{sources:[]},params:{}});a.windowManager.open({file:i+"/media.htm",width:600+parseInt(a.getLang("media.delta_width",0)),height:505+parseInt(a.getLang("media.delta_height",0)),inline:1},{plugin_url:i,data:d})});
a.addButton("media",{title:"media.desc",cmd:"mceMedia"});a.onNodeChange.add(function(a,b,c){b.setActive("media",e(c))})},convertUrl:function(a,i){var e=this.editor,c=e.settings,g=c.url_converter,c=c.url_converter_scope||this;return!a?a:i?e.documentBaseURI.toAbsolute(a):g.call(c,a,"src","object")},getInfo:function(){return{longname:"Media",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/media",version:tinymce.majorVersion+
"."+tinymce.minorVersion}},dataToImg:function(a,i){var e,c;a.params.src=this.convertUrl(a.params.src,i);if(e=a.video.attrs)e.src=this.convertUrl(e.src,i);e&&(e.poster=this.convertUrl(e.poster,i));if(e=F(a.video.sources))for(c=0;c<e.length;c++)e[c].src=this.convertUrl(e[c].src,i);e=this.editor.dom.create("img",{id:a.id,style:a.style,align:a.align,hspace:a.hspace,vspace:a.vspace,src:this.editor.theme.url+"/img/trans.gif","class":"mceItemMedia mceItem"+this.getType(a.type).name,"data-mce-json":y.serialize(a,
"'")});e.width=a.width=s(a.width||("audio"==a.type?"300":"320"));e.height=a.height=s(a.height||("audio"==a.type?"32":"240"));return e},dataToHtml:function(a,i){return this.editor.serializer.serialize(this.dataToImg(a,i),{forced_root_block:"",force_absolute:i})},htmlToData:function(a){var i,e;e={type:"flash",video:{sources:[]},params:{}};if(i=this.editor.parser.parse(a).getAll("img")[0])e=y.parse(i.attr("data-mce-json")),e.type=this.getType(i.attr("class")).name.toLowerCase(),tinymce.each(w,function(a){var g=
i.attr(a);g&&(e[a]=g)});return e},getType:function(a){var i,e;i=tinymce.explode(a," ");for(a=0;a<i.length;a++)if(e=this.lookup[i[a]])return e},imgToObject:function(a,i){function e(a,d){var e,f,h;if(h=g.getParam("flash_video_player_url",c.convertUrl(c.url+"/moxieplayer.swf")))e=g.documentBaseURI,b.params.src=h,g.getParam("flash_video_player_absvideourl",!0)&&(a=e.toAbsolute(a||"",!0),d=e.toAbsolute(d||"",!0)),f="",e=g.getParam("flash_video_player_flashvars",{url:"$url",poster:"$poster"}),tinymce.each(e,
function(b,c){b=b.replace(/\$url/,a||"");b=b.replace(/\$poster/,d||"");b.length>0&&(f=f+((f?"&":"")+c+"="+escape(b)))}),f.length&&(b.params.flashvars=f),e=g.getParam("flash_video_player_params",{allowfullscreen:!0,allowscriptaccess:!0}),tinymce.each(e,function(a,c){b.params[c]=""+a})}var c=this,g=c.editor,k,j,l,d,h,b,m,p,o,t,r,f,n,v;if(b=a.attr("data-mce-json"))if(b=y.parse(b),p=this.getType(a.attr("class")),n=a.attr("data-mce-style"),n||(n=a.attr("style"))&&(n=g.dom.serializeStyle(g.dom.parseStyle(n,
"img"))),b.width=a.attr("width")||b.width,b.height=a.attr("height")||b.height,"Iframe"===p.name){r=new q("iframe",1);tinymce.each(w,function(b){var c=a.attr(b);b=="class"&&c&&(c=c.replace(/mceItem.+ ?/g,""));c&&c.length>0&&r.attr(b,c)});for(d in b.params)r.attr(d,b.params[d]);r.attr({style:n,frameborder:"0",src:b.params.src});a.replace(r)}else if(this.editor.settings.media_use_script)r=(new q("script",1)).attr("type","text/javascript"),h=new q("#text",3),h.value="write"+p.name+"("+y.serialize(tinymce.extend(b.params,
{width:a.attr("width"),height:a.attr("height")}))+");",r.append(h),a.replace(r);else{if("Video"===p.name&&b.video.sources[0]){k=(new q("video",1)).attr(tinymce.extend({id:a.attr("id"),width:s(a.attr("width")),height:s(a.attr("height")),style:n},b.video.attrs));b.video.attrs&&(f=b.video.attrs.poster);m=b.video.sources=F(b.video.sources);for(o=0;o<m.length;o++)/\.mp4$/.test(m[o].src)&&(t=m[o].src);m[0].type||(k.attr("src",m[0].src),m.splice(0,1));for(o=0;o<m.length;o++)h=(new q("source",1)).attr(m[o]),
h.shortEnded=!0,k.append(h);t?(e(t,f),p=c.getType("flash")):b.params.src=""}if("Audio"===p.name&&b.video.sources[0]){v=(new q("audio",1)).attr(tinymce.extend({id:a.attr("id"),width:s(a.attr("width")),height:s(a.attr("height")),style:n},b.video.attrs));b.video.attrs&&(f=b.video.attrs.poster);m=b.video.sources=F(b.video.sources);m[0].type||(v.attr("src",m[0].src),m.splice(0,1));for(o=0;o<m.length;o++)h=(new q("source",1)).attr(m[o]),h.shortEnded=!0,v.append(h);b.params.src=""}if("EmbeddedAudio"===p.name){l=
new q("embed",1);l.shortEnded=!0;l.attr({id:a.attr("id"),width:s(a.attr("width")),height:s(a.attr("height")),style:n,type:a.attr("type")});for(d in b.params)l.attr(d,b.params[d]);tinymce.each(w,function(a){b[a]&&a!="type"&&l.attr(a,b[a])});b.params.src=""}if(b.params.src){/\.flv$/i.test(b.params.src)&&e(b.params.src,"");i&&i.force_absolute&&(b.params.src=g.documentBaseURI.toAbsolute(b.params.src));j=(new q("object",1)).attr({id:a.attr("id"),width:s(a.attr("width")),height:s(a.attr("height")),style:n});
tinymce.each(w,function(a){var c=b[a];a=="class"&&c&&(c=c.replace(/mceItem.+ ?/g,""));c&&a!="type"&&j.attr(a,c)});for(d in b.params)m=new q("param",1),m.shortEnded=!0,h=b.params[d],"src"===d&&"WindowsMedia"===p.name&&(d="url"),m.attr({name:d,value:h}),j.append(m);if(this.editor.getParam("media_strict",!0))j.attr({data:b.params.src,type:p.mimes[0]});else{j.attr({classid:"clsid:"+p.clsids[0],codebase:p.codebase});l=new q("embed",1);l.shortEnded=!0;l.attr({id:a.attr("id"),width:s(a.attr("width")),height:s(a.attr("height")),
style:n,type:p.mimes[0]});for(d in b.params)l.attr(d,b.params[d]);tinymce.each(w,function(a){b[a]&&a!="type"&&l.attr(a,b[a])});j.append(l)}b.object_html&&(h=new q("#text",3),h.raw=!0,h.value=b.object_html,j.append(h));k&&k.append(j)}k&&b.video_html&&(h=new q("#text",3),h.raw=!0,h.value=b.video_html,k.append(h));v&&b.video_html&&(h=new q("#text",3),h.raw=!0,h.value=b.video_html,v.append(h));(k=k||v||j||l)?a.replace(k):a.remove()}},objectToImg:function(a){function i(a){return(new tinymce.html.Serializer({inner:!0,
validate:!1})).serialize(a)}function e(a,b){return v[(a.attr(b)||"").toLowerCase()]}var c,g,k,j,l,d,h,b,m,p,o,t,r,f,n,v=this.lookup,u,D=this.editor.settings.url_converter,E=this.editor.settings.url_converter_scope,z,A,B,C;if(a.parent){if("script"===a.name){a.firstChild&&(d=x.exec(a.firstChild.value));if(!d)return;n=d[1];f={video:{},params:y.parse(d[2])};b=f.params.width;m=f.params.height}f=f||{video:{},params:{}};l=new q("img",1);l.attr({src:this.editor.theme.url+"/img/trans.gif"});d=a.name;if("video"===
d||"audio"==d){k=a;c=a.getAll("object")[0];g=a.getAll("embed")[0];b=k.attr("width");m=k.attr("height");h=k.attr("id");f.video={attrs:{},sources:[]};u=f.video.attrs;for(d in k.attributes.map)u[d]=k.attributes.map[d];(t=a.attr("src"))&&f.video.sources.push({src:D.call(E,t,"src",a.name)});r=k.getAll("source");for(o=0;o<r.length;o++)t=r[o].remove(),f.video.sources.push({src:D.call(E,t.attr("src"),"src","source"),type:t.attr("type"),media:t.attr("media")});u.poster&&(u.poster=D.call(E,u.poster,"poster",
a.name))}"object"===a.name&&(c=a,g=a.getAll("embed")[0]);"embed"===a.name&&(g=a);"iframe"===a.name&&(j=a,n="Iframe");if(c){b=b||c.attr("width");m=m||c.attr("height");p=p||c.attr("style");h=h||c.attr("id");z=z||c.attr("hspace");A=A||c.attr("vspace");B=B||c.attr("align");C=C||c.attr("bgcolor");f.name=c.attr("name");r=c.getAll("param");for(o=0;o<r.length;o++)t=r[o],d=t.remove().attr("name"),G[d]||(f.params[d]=t.attr("value"));f.params.src=f.params.src||c.attr("data")}if(g)for(d in b=b||g.attr("width"),
m=m||g.attr("height"),p=p||g.attr("style"),h=h||g.attr("id"),z=z||g.attr("hspace"),A=A||g.attr("vspace"),B=B||g.attr("align"),C=C||g.attr("bgcolor"),g.attributes.map)!G[d]&&!f.params[d]&&(f.params[d]=g.attributes.map[d]);if(j)for(d in b=s(j.attr("width")),m=s(j.attr("height")),p=p||j.attr("style"),h=j.attr("id"),z=j.attr("hspace"),A=j.attr("vspace"),B=j.attr("align"),C=j.attr("bgcolor"),tinymce.each(w,function(a){l.attr(a,j.attr(a))}),j.attributes.map)!G[d]&&!f.params[d]&&(f.params[d]=j.attributes.map[d]);
f.params.movie&&(f.params.src=f.params.src||f.params.movie,delete f.params.movie);f.params.src&&(f.params.src=D.call(E,f.params.src,"src","object"));k&&("video"===a.name?n=v.video.name:"audio"===a.name&&(n=v.audio.name));c&&!n&&(n=(e(c,"clsid")||e(c,"classid")||e(c,"type")||{}).name);if(g&&!n){if(!(n=e(g,"type")))n=f.params.src.replace(/^.*\.([^.]+)$/,"$1"),n=v[n.toLowerCase()||""]||{};n=n.name}g&&"EmbeddedAudio"==n&&(f.params.type=g.attr("type"));a.replace(l);g&&g.remove();if(c&&(c=i(c.remove())))f.object_html=
c;if(k&&(c=i(k.remove())))f.video_html=c;f.hspace=z;f.vspace=A;f.align=B;f.bgcolor=C;l.attr({id:h,"class":"mceItemMedia mceItem"+(n||"Flash"),style:p,width:b||("audio"==a.name?"300":"320"),height:m||("audio"==a.name?"32":"240"),hspace:z,vspace:A,align:B,bgcolor:C,"data-mce-json":y.serialize(f,"'")})}}});tinymce.PluginManager.add("media",tinymce.plugins.MediaPlugin)})();